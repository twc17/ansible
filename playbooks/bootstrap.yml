---
- hosts: all
  remote_user: root
  gather_facts: True
  tasks:
  - name: Install some lovely packages
    yum:
      name: "{{ packages }}"
    vars:
      packages:
      - nmap
      - sysstat
      - lsof
      - vim
      - cifs-utils
      - kernel-devel
      - gcc
      - bind-utils
      - telnet
      - sssd
      - openssl
      - rsync
      - curl
      - wget
      - git
      - ipmitool
      - tree
  - name: Disable SELinux
    selinux:
      state: disabled
  - name: Configure LDAP
    block:
      - copy:
          src: files/ldap.conf
          dest: /etc/openldap/ldap.conf
          owner: root
          group: root
          mode: 0644
      - file:
          path: /etc/openldap/cacerts
          state: directory
          mode: 0755
      - copy:
          src: files/ca-bundle.crt
          dest: /etc/openldap/cacerts/ca-bundle.crt
          owner: root
          group: root
          mode: 0644
      - copy:
          src: files/sam-ldap-prod-01.cssd.pitt.edu.crt
          dest: /etc/openldap/cacerts/sam-ldap-prod-01.cssd.pitt.edu.crt
          owner: root
          group: root
          mode: 0644
  - name: Configure SSSD
    copy:
      src: files/sssd.conf
      dest: /etc/sssd/sssd.conf
      owner: root
      group: root
      mode: 0600
  - name: Configure nsswitch file
    copy:
      src: files/nsswitch.conf
      dest: /etc/nsswitch.conf
      owner: root
      group: root
      mode: 0644
  - name: Configure system-auth PAM
    copy:
      src: files/system-auth-ac
      dest: /etc/pam.d/system-auth-ac
      owner: root
      group: root
      mode: 0644
  - name: Configure password-auth PAM
    copy:
      src: files/password-auth-ac
      dest: /etc/pam.d/password-auth-ac
      owner: root
      group: root
      mode: 0644



